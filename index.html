<!doctype html>
<html lang="en">
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<head>
  <meta charset="utf-8" />
  <title>Grow tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="headline">
    <h1>Grow Tracker</h1>
    <div id="notification">This is a notification
      <div id="windNotification">Wind Notification</div>
      <div id="tempNotification">Temp Notification</div>
    </div>
  </div>
<!--   <a href="https://roeepanzer.github.io/learning/clock.html">link to my live clock</a> -->
  <div id="clockArea">The current time: <div id="clock">Loading...</div></div>
  <script>
    function updateClock() {
      const now = new Date();

      // Format HH:MM:SS
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');

      // Format DD.MM.YYYY
      const day = String(now.getDate()).padStart(2, '0');
      const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
      const year = now.getFullYear();

      const timeString = `${hours}:${minutes}:${seconds}`;
      const dateString = `${day}.${month}.${year}`;

      document.getElementById('clock').textContent = `${dateString}   ${timeString}`;
    }
    // Update immediately, then every second
    updateClock();
    setInterval(updateClock, 1000);
  </script>
  
  <div class="gauges">
    <section class="gauge" data-type="light">
      <div class="gauge__title">Light</div>
      <div class="gauge__dial">
        <div class="gauge__value" id="lightView">NoLight</div>
        <div class="lightConverted"><nobr id="lightConverted">NoValue</nobr></div> <!--µmol·m⁻²·s⁻¹-->
        <div class="gauge__unit">lux</div>
      </div>
    </section>
  
    <section class="gauge" data-type="temp">
      <div class="gauge__title">Temperature</div>
      <div class="gauge__dial">
        <div class="gauge__value" id="tempView">NoTemp</div>
        <div class="gauge__unit">&deg;C</div>
      </div>
    </section>
  
    <section class="gauge" data-type="hum">
      <div class="gauge__title">humidity</div>
      <div class="gauge__dial">
        <div class="gauge__value" id="humidView">noHumid</div>
        <div class="gauge__unit">%</div>
      </div>
    </section>

    <section class="gauge" data-type="wind">
      <div class="gauge__title">Wind</div>
      <div class="gauge__dial">
        <div class="gauge__value" id="windView">noWind</div>
        <div class="gauge__unit">km/h</div>
      </div>
    </section>
  </div>
<!--   <h3>Logs</h3> -->
<!--   <pre id="log"></pre> -->
  <div id="weather">
    <h2>Current weather</h2>
    <div id="liveWeather">
      <!-- <p>current country: <div id="country"></div> </p> -->
      <div>Temperature: <nobr id="tempAPI">temp</nobr>&deg;C</div>
      <div>Relative Humidity: <nobr id="humidAPI">humid</nobr>%</div>
      <div>Precipitations: <nobr id="precipAPI">precip</nobr> mm</div>
      <div>Wind Speed: <nobr id="windSpAPI">windsp</nobr> km/h (Level <nobr id="windLeAPI">windLe</nobr>)</div>
      <div>Wind Gusts: <nobr id="windGuAPI">windgu</nobr> km/h (Level <nobr id="windGuLeAPI">windGuLe</nobr>)</div>
      <div>Wind direction: <nobr id="windDiAPI">winddi</nobr> &deg;</div>
      <!-- <div>Wind Level: </div>
      <div>Wind gusts level: </div> -->
      <div>Timestamp: <nobr id="timestamp"></nobr></div>
    </div>
    
    <script>
      // const url = "https://api.country.is/";
      // const url = "https://api.open-meteo.com/v1/forecast?latitude=51.793181954585414&longitude=6.159587746646279&hourly=wind_speed_80m,wind_direction_10m,wind_direction_80m,wind_gusts_10m,wind_speed_10m,cloud_cover,precipitation_probability,precipitation&current=wind_speed_10m,wind_direction_10m,wind_gusts_10m,temperature_2m,relative_humidity_2m,precipitation&minutely_15=wind_gusts_10m,precipitation,wind_speed_10m&timezone=Europe%2FBerlin&forecast_days=3";
      const CurrentURL = "https://api.open-meteo.com/v1/forecast?latitude=51.79&longitude=6.148&current=temperature_2m,relative_humidity_2m,precipitation,wind_speed_10m,wind_direction_10m,wind_gusts_10m,cloud_cover&timezone=Europe%2FBerlin&forecast_days=3";
      
      const level0Bottom = 0;
      const level0Top = 1;
      const level1Bottom = 1;
      const level1Top = 5;
      const level2Bottom = 6;
      const level2Top = 11;
      const level3Bottom = 12;
      const level3Top = 19;
      const level4Bottom = 20;
      const level4Top = 28;
      const level5Bottom = 29;
      const level5Top = 38;
      const level6Bottom = 39;
      const level6Top = 49;
      const level7Bottom = 50;
      const level7Top = 61;
      const level8Bottom = 62;
      const level8Top = 74;
      const level9Bottom = 75;
      const level9Top = 88;
      const level10Bottom = 89;
      const level10Top = 102;
      const level11Bottom = 103;
      const level11Top = 117;
      const level12Bottom = 118;

      getAndSet(CurrentURL);
      setInterval(getAndSet, 900000, CurrentURL);

      async function getAndSet(url) {
        try{
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error(`Response status: ${response.status}`);
          }
          let result = await response.json();
          document.getElementById("tempAPI").innerHTML = result.current.temperature_2m;
          document.getElementById("humidAPI").innerHTML = result.current.relative_humidity_2m;
          document.getElementById("precipAPI").innerHTML = result.current.precipitation;
          document.getElementById("windSpAPI").innerHTML = result.current.wind_speed_10m;
          document.getElementById("windGuAPI").innerHTML = result.current.wind_gusts_10m;
          document.getElementById("windDiAPI").innerHTML = result.current.wind_direction_10m;
          document.getElementById("windLeAPI").innerHTML = windLevelSet(result.current.wind_speed_10m);
          document.getElementById("windGuLeAPI").innerHTML = windLevelSet(result.current.wind_gusts_10m);
          document.getElementById("timestamp").innerHTML = result.current.time;
        }
        catch (error) {
          console.error(error.message);
        }
      }

      function windLevelSet(windSpeed) {
        if(windSpeed >= level0Bottom && windSpeed <= level0Top) {
          return 0;
        }
        else if(windSpeed >= level1Bottom && windSpeed <= level1Top) {
          return 1;
        }
        else if(windSpeed >= level2Bottom && windSpeed <= level2Top) {
          return 2;
        }
        else if(windSpeed >= level3Bottom && windSpeed <= level3Top) {
          return 3;
        }
        else if(windSpeed >= level4Bottom && windSpeed <= level4Top) {
          return 4;
        }
        else if(windSpeed >= level5Bottom && windSpeed <= level5Top) {
          return 5;
        }
        else if(windSpeed >= level6Bottom && windSpeed <= level6Top) {
          return 6;
        }
        else if(windSpeed >= level7Bottom && windSpeed <= level7Top) {
          return 7;
        }
        else if(windSpeed >= level8Bottom && windSpeed <= level8Top) {
          return 8;
        }
        else if(windSpeed >= level9Bottom && windSpeed <= level9Top) {
          return 9;
        }
        else if(windSpeed >= level10Bottom && windSpeed <= level10Top) {
          return 10;
        }
        else if(windSpeed >= level11Bottom && windSpeed <= level11Top) {
          return 11;
        }
        else if(windSpeed >= level12Bottom && windSpeed <= level12Top) {
          return 12;
        }
        else {
          return -1;
        }
      }

      async function notificationSet(value) {
        
      }
    </script>
    
    <h2>Weather Forcast</h2>
      <div id="forcast">
        <div id="day1">
          <b><div id="day1day">Thursday</div></b>
          <b><div id="day1date">06/02/2026</div></b>
          <div>Temp High: <nobr id="day1tempHigh"></nobr>&deg;C</div>
          <div>Temp Low: <nobr id="day1tempLow"></nobr>&deg;C</div>
          <div>Humidity: <nobr id="day1humid"></nobr>%</div>
          <div>Precipitation: <nobr id="day1precip"></nobr> mm</div>
          <div>Cloud Cover: <nobr id="day1cloud"></nobr>%</div>
          <div>Wind Speed: <nobr id="day1wind"></nobr> km/h</div>
          <div>Wind Gusts: <nobr id="day1gusts"></nobr> km/h</div>
          <div>Wind Direction: <nobr id="day1direction"></nobr> &deg;</div>
        </div>
        <div id="day2">
          <b><div id="day2day">Friday</div></b>
          <b><div id="day2date">07/02/2026</div></b>
          <div>Temp High: <nobr id="day2tempHigh"></nobr>&deg;C</div>
          <div>Temp Low: <nobr id="day2tempLow"></nobr>&deg;C</div>
          <div>Humidity: <nobr id="day2humid"></nobr>%</div>
          <div>Precipitation: <nobr id="day2precip"></nobr> mm</div>
          <div>Cloud Cover: <nobr id="day2cloud"></nobr>%</div>
          <div>Wind Speed: <nobr id="day2wind"></nobr> km/h</div>
          <div>Wind Gusts: <nobr id="day2gusts"></nobr> km/h</div>
          <div>Wind Direction: <nobr id="day2direction"></nobr> &deg;</div>
        </div>
        <div id="day3">
          <b><div id="day3day">Saturday</div></b>
          <b><div id="day3date">08/02/2026</div></b>
          <div>Temp High: <nobr id="day3tempHigh"></nobr>&deg;C</div>
          <div>Temp Low: <nobr id="day3tempLow"></nobr>&deg;C</div>
          <div>Humidity: <nobr id="day3humid"></nobr>%</div>
          <div>Precipitation: <nobr id="day3precip"></nobr> mm</div>
          <div>Cloud Cover: <nobr id="day3cloud"></nobr>%</div>
          <div>Wind Speed: <nobr id="day3wind"></nobr> km/h</div>
          <div>Wind Gusts: <nobr id="day3gusts"></nobr> km/h</div>
          <div>Wind Direction: <nobr id="day3direction"></nobr> &deg;</div>
        </div>
      </div>

    <script>
      const forecastURL = "https://api.open-meteo.com/v1/forecast?latitude=51.793056&longitude=6.159563&hourly=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,precipitation_probability,cloud_cover,wind_speed_80m,wind_direction_80m,wind_gusts_10m&timezone=Europe%2FBerlin&forecast_days=3";
      const day1Begin = 0;
      const day1End = 23;
      const day2Begin = 24;
      const day2End = 47;
      const day3Begin = 48;
      const day3End = 72;

      day1array = [[], [], [], [], [], [], [], [], [], []];
      day2array = [[], [], [], [], [], [], [], [], [], []];
      day3array = [[], [], [], [], [], [], [], [], [], []];

      const today = new Date();
      const tomorrow = new Date(today);
      tomorrow.setDate(today.getDate() + 1);
      const dayAfter = new Date(today);
      dayAfter.setDate(today.getDate() + 2);

      document.getElementById("day1date").innerHTML = today.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
      document.getElementById("day2date").innerHTML = tomorrow.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
      document.getElementById("day3date").innerHTML = dayAfter.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
      document.getElementById("day1day").innerHTML = today.toLocaleDateString('en-GB', { weekday: 'long' });
      document.getElementById("day2day").innerHTML = tomorrow.toLocaleDateString('en-GB', { weekday: 'long' });
      document.getElementById("day3day").innerHTML = dayAfter.toLocaleDateString('en-GB', { weekday: 'long' });

      let day1values = Array(24).fill(null).map(() => Array(10).fill(0));
      let day2values = Array(24).fill(null).map(() => Array(10).fill(0));
      let day3values = Array(24).fill(null).map(() => Array(10).fill(0));

      function averageValues(values) {
        return values.reduce((a, b) => a + b, 0) / values.length;
      }

      function highestValue(values) {
        return values.reduce((a, b) => a > b ? a : b);
      }

      function lowestValue(values) {
        return values.reduce((a, b) => a < b ? a : b);
      }

      function formatDecimal(num, decimals = 2) {
        return Number(num).toFixed(decimals);
      }

      async function getAndSetForecast(url) {
        try{
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error(`Response status: ${response.status}`);
          }
          let result = await response.json();

          // Populate day1 values
          for (let i = day1Begin; i < day3End; i++) {
            if(i <= day1End) {
              day1values[i][0] = result.hourly.time[i];
              day1values[i][1] = result.hourly.temperature_2m[i]; 
              day1values[i][2] = result.hourly.relative_humidity_2m[i]; 
              day1values[i][3] = result.hourly.apparent_temperature[i];
              day1values[i][4] = result.hourly.precipitation[i];
              day1values[i][5] = result.hourly.precipitation_probability[i];
              day1values[i][6] = result.hourly.cloud_cover[i];
              day1values[i][7] = result.hourly.wind_speed_80m[i]; 
              day1values[i][8] = result.hourly.wind_direction_80m[i];
              day1values[i][9] = result.hourly.wind_gusts_10m[i];
            }
            else if(i >= day2Begin && i <= day2End) {
              day2values[i-day2Begin][0] = result.hourly.time[i];
              day2values[i-day2Begin][1] = result.hourly.temperature_2m[i]; 
              day2values[i-day2Begin][2] = result.hourly.relative_humidity_2m[i]; 
              day2values[i-day2Begin][3] = result.hourly.apparent_temperature[i];
              day2values[i-day2Begin][4] = result.hourly.precipitation[i];
              day2values[i-day2Begin][5] = result.hourly.precipitation_probability[i];
              day2values[i-day2Begin][6] = result.hourly.cloud_cover[i];
              day2values[i-day2Begin][7] = result.hourly.wind_speed_80m[i]; 
              day2values[i-day2Begin][8] = result.hourly.wind_direction_80m[i];
              day2values[i-day2Begin][9] = result.hourly.wind_gusts_10m[i];
            }
            else if(i >= day3Begin && i <= day3End) {
              day3values[i-day3Begin][0] = result.hourly.time[i];
              day3values[i-day3Begin][1] = result.hourly.temperature_2m[i]; 
              day3values[i-day3Begin][2] = result.hourly.relative_humidity_2m[i]; 
              day3values[i-day3Begin][3] = result.hourly.apparent_temperature[i];
              day3values[i-day3Begin][4] = result.hourly.precipitation[i];
              day3values[i-day3Begin][5] = result.hourly.precipitation_probability[i];
              day3values[i-day3Begin][6] = result.hourly.cloud_cover[i];
              day3values[i-day3Begin][7] = result.hourly.wind_speed_80m[i]; 
              day3values[i-day3Begin][8] = result.hourly.wind_direction_80m[i];
              day3values[i-day3Begin][9] = result.hourly.wind_gusts_10m[i];
            }
          }
          day1array = day1values;
          day2array = day2values;
          day3array = day3values;
        }
        catch (error) {
          console.error(error.message);
        }

        document.getElementById("day1tempHigh").innerHTML = formatDecimal(highestValue(day1values.map(r => r[1])));
        document.getElementById("day1tempLow").innerHTML = formatDecimal(lowestValue(day1values.map(r => r[1])));
        document.getElementById("day1humid").innerHTML = formatDecimal(averageValues(day1values.map(r => r[2])));
        document.getElementById("day1precip").innerHTML = formatDecimal(averageValues(day1values.map(r => r[4])));
        document.getElementById("day1cloud").innerHTML = formatDecimal(averageValues(day1values.map(r => r[6])));
        document.getElementById("day1wind").innerHTML = formatDecimal(averageValues(day1values.map(r => r[7])));
        document.getElementById("day1gusts").innerHTML = formatDecimal(averageValues(day1values.map(r => r[9])));
        document.getElementById("day1direction").innerHTML = formatDecimal(averageValues(day1values.map(r => r[8])));

        document.getElementById("day2tempHigh").innerHTML = formatDecimal(highestValue(day2values.map(r => r[1])));
        document.getElementById("day2tempLow").innerHTML = formatDecimal(lowestValue(day2values.map(r => r[1])));
        document.getElementById("day2humid").innerHTML = formatDecimal(averageValues(day2values.map(r => r[2])));
        document.getElementById("day2precip").innerHTML = formatDecimal(averageValues(day2values.map(r => r[4])));
        document.getElementById("day2cloud").innerHTML = formatDecimal(averageValues(day2values.map(r => r[6])));
        document.getElementById("day2wind").innerHTML = formatDecimal(averageValues(day2values.map(r => r[7])));
        document.getElementById("day2gusts").innerHTML = formatDecimal(averageValues(day2values.map(r => r[9])));
        document.getElementById("day2direction").innerHTML = formatDecimal(averageValues(day2values.map(r => r[8])));

        document.getElementById("day3tempHigh").innerHTML = formatDecimal(highestValue(day3values.map(r => r[1])));
        document.getElementById("day3tempLow").innerHTML = formatDecimal(lowestValue(day3values.map(r => r[1])));
        document.getElementById("day3humid").innerHTML = formatDecimal(averageValues(day3values.map(r => r[2])));
        document.getElementById("day3precip").innerHTML = formatDecimal(averageValues(day3values.map(r => r[4])));
        document.getElementById("day3cloud").innerHTML = formatDecimal(averageValues(day3values.map(r => r[6])));
        document.getElementById("day3wind").innerHTML = formatDecimal(averageValues(day3values.map(r => r[7])));
        document.getElementById("day3gusts").innerHTML = formatDecimal(averageValues(day3values.map(r => r[9])));
        document.getElementById("day3direction").innerHTML = formatDecimal(averageValues(day3values.map(r => r[8])));
      
      }

      getAndSetForecast(forecastURL);
    </script>
    
    <h2>Weather Forcast</h2>
    <a class="weatherwidget-io" href="https://forecast7.com/en/51d796d13/kleve/" data-label_1="KLEVE" data-label_2="WEATHER" data-icons="Climacons" data-days="3" data-theme="original" >KLEVE WEATHER</a>
  
  </div>
  <script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='https://weatherwidget.io/js/widget.min.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','weatherwidget-io-js');
  </script>

  <div id="pastWeather">
    <div id="Day1Graph" style="width:100%;max-width:700px"></div>
  </div>
  
  <script>
    const xArray = day1array[0];
    const yArray = day1array[1];

    const data = [{x: xArray, y: yArray, mode: "lines"}];
    const layout = {
      xaxis: {range: [0,24], title: "Time of the day"},
      yaxis: {range: [0,40], title: "Temperature"}
    };

    Plotly.newPlot("Day1Graph", data, layout);
  </script>


  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    // import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
    
    // const log = (...args) => {console.log(...args); document.getElementById('log').textContent += args.join(' ') + '\n'; };
    const lightEl = document.getElementById('lightView');
    const lightConvEl = document.getElementById('lightConverted');
    const tempEl = document.getElementById('tempView');
    const humidEl = document.getElementById('humidView');

    const firebaseConfig = {
      apiKey: "AIzaSyAVMPlPrVKRvZ6VPdyXHlmxEQjmL1tmges",
      authDomain: "learning-d6e02.firebaseapp.com",
      databaseURL: "https://learning-d6e02-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "learning-d6e02",
      storageBucket: "learning-d6e02.firebasestorage.app",
      messagingSenderId: "119584364745",
      appId: "1:119584364745:web:62fe63a64dddbc8c329518",
      measurementId: "G-85VLDXL87W"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    async function liveHumid() {
      onValue(ref(db, 'liveData/humidity'), (snapshot) => {
        if(snapshot.exists()) {
          const value = snapshot.val();
          humidEl.textContent = value;
        }
      });
    }

    async function liveTemp() {
      onValue(ref(db, 'liveData/temp'), (snapshot) => {
        if(snapshot.exists()) {
          const value = snapshot.val();
          tempEl.textContent = value;
        }
      });
    }

    async function liveLight() {
      onValue(ref(db, 'liveData/light'), (snapshot) => {
        if(snapshot.exists()) {
          const value = snapshot.val();
          lightEl.textContent = value;
        }
      });
    }

    async function liveLightConverted() {
      onValue(ref(db, 'liveData/lightConverted'), (snapshot) => {
        if(snapshot.exists()) {
          const value = snapshot.val();
          lightConvEl.textContent = value;
        }
      });
    }
    
    // async function onValueLiveGeneralData() {
    //   onValue(ref(db, 'test'), (snapshot) => {
    //     if(snapshot.exists()) {
    //       const value = snapshot.val();
    //       log("---------");
    //       log("General value is: " + value);
    //       log("int value is: " + value.int);
    //       log("float value is: " + value.float);
    //       log("---------");
    //       GeneralEl.textContent = value;
    //     }
    //   });
    // }
    
    async function testConn() {
      statusEl.textContent = 'Writing test value…';
      set(ref(db, 'test/connection'), {status: "ok", timeStamp: Date.now() });
      log('Write succeeded');
    };

    // Sign in so Realtime Database rules allow read (auth !== null)
    async function initLiveData() {
      try {
        await signInAnonymously(auth);
      } catch (e) {
        console.error('Firebase auth failed:', e);
        return;
      }
      liveLight();
      liveLightConverted();
      liveTemp();
      liveHumid();
    }
    initLiveData();
  </script>
</body>
</html>
